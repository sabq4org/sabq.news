# ØªÙ‚ÙˆÙŠÙ… Ø³Ø¨Ù‚ - Sabq Editorial Calendar System

## Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© - Overview

Ù†Ø¸Ø§Ù… ØªÙ‚ÙˆÙŠÙ… Ø³Ø¨Ù‚ Ù‡Ùˆ Ù†Ø¸Ø§Ù… ØªØ­Ø±ÙŠØ±ÙŠ Ù…ØªÙƒØ§Ù…Ù„ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ù‡Ø§Ù…Ø©ØŒ Ù…Ø¹ ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ Ø°ÙƒÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… AI ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… ÙˆØ§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª.

The Sabq Calendar is a comprehensive editorial calendar system for managing important events and occasions, with AI-powered content generation, task management, and automated reminders.

## âœ¨ Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© - Key Features

### 1. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø­Ø¯Ø§Ø« - Event Management
- **Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«**: Ø¹Ø§Ù„Ù…ÙŠ (GLOBAL)ØŒ ÙˆØ·Ù†ÙŠ (NATIONAL)ØŒ Ø¯Ø§Ø®Ù„ÙŠ (INTERNAL)
- **Ù…Ø³ØªÙˆÙŠØ§Øª Ø§Ù„Ø£Ù‡Ù…ÙŠØ©**: 1 (Ù…Ù†Ø®ÙØ¶) Ø¥Ù„Ù‰ 5 (Ø¹Ø§Ø¬Ù„ Ø¬Ø¯Ø§Ù‹)
- **Ø§Ù„ØªØµÙÙŠØ© ÙˆØ§Ù„Ø¨Ø­Ø«**: Ø­Ø³Ø¨ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„Ù†ÙˆØ¹ØŒ Ø§Ù„Ø£Ù‡Ù…ÙŠØ©ØŒ Ø§Ù„ÙˆØ³ÙˆÙ…
- **Ø§Ù„Ø±Ø¨Ø· Ø¨Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª**: Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰

### 2. Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø°ÙƒÙŠ Ù„Ù„Ù…Ø­ØªÙˆÙ‰ - AI Content Generation
- **Ø£ÙÙƒØ§Ø± ØªØ­Ø±ÙŠØ±ÙŠØ©**: 5 Ø²ÙˆØ§ÙŠØ§ Ù‚ØµØµÙŠØ© Ù„ÙƒÙ„ Ø­Ø¯Ø«
- **Ø¹Ù†Ø§ÙˆÙŠÙ†**: Ø±Ø¦ÙŠØ³ÙŠØŒ Ø«Ø§Ù†ÙˆÙŠØŒ Ùˆ3 Ø¨Ø¯Ø§Ø¦Ù„
- **Ø¥Ù†ÙÙˆØ¬Ø±Ø§ÙÙŠÙƒ**: 8 Ù†Ù‚Ø§Ø· Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©
- **Ù…Ø­ØªÙˆÙ‰ Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§**: ØªÙˆÙŠØªØ±ØŒ Ø¥Ù†Ø³ØªØ¬Ø±Ø§Ù…ØŒ Ù„ÙŠÙ†ÙƒØ¯Ø¥Ù† Ù…Ø¹ Ù‡Ø§Ø´ØªØ§Ø¬Ø§Øª
- **SEO**: ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ©ØŒ Ø¹Ù†ÙˆØ§Ù† Ù…ÙŠØªØ§ØŒ ÙˆØµÙ Ù…ÙŠØªØ§
- **Ù…Ø³ÙˆØ¯Ø© Ù…Ù‚Ø§Ù„ ÙƒØ§Ù…Ù„**: Ù…Ù† Ø£ÙŠ Ø²Ø§ÙˆÙŠØ© ØªØ­Ø±ÙŠØ±ÙŠØ©

### 3. Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù‡Ø§Ù… - Task Management
- **ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ù‡Ø§Ù…**: Ù„Ù…Ø­Ø±Ø±ÙŠÙ†ØŒ Ù…Ø±Ø§Ø³Ù„ÙŠÙ†ØŒ Ù…ØµÙ…Ù…ÙŠÙ†ØŒ ÙØ±ÙŠÙ‚ Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…ÙŠØ¯ÙŠØ§
- **Ø­Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù‡Ø§Ù…**: pending, in_progress, done, cancelled
- **Ø§Ù„Ø£Ø¯ÙˆØ§Ø±**: editor, reporter, designer, social
- **Ø§Ù„ØªØªØ¨Ø¹**: Ù…ØªØ§Ø¨Ø¹Ø© ØªÙ‚Ø¯Ù… ÙƒÙ„ Ù…Ù‡Ù…Ø©

### 4. Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª - Reminders
- **Ù‚Ù†ÙˆØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø©**: IN_APP, EMAIL, WHATSAPP, SLACK
- **Ø¬Ø¯ÙˆÙ„Ø© Ù…Ø±Ù†Ø©**: ØªØ°ÙƒÙŠØ± Ù‚Ø¨Ù„ Ø§Ù„Ø­Ø¯Ø« Ø¨Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ù…Ø­Ø¯Ø¯
- **Ø±Ø³Ø§Ø¦Ù„ Ù…Ø®ØµØµØ©**: Ø±Ø³Ø§Ù„Ø© ØªØ°ÙƒÙŠØ± Ù„ÙƒÙ„ Ø­Ø¯Ø«
- **ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„**: Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ ÙƒÙ„ ØªØ°ÙƒÙŠØ±

### 5. Ø§Ù„Ø£ØªÙ…ØªØ© - Automation
- **ØªÙˆÙ„ÙŠØ¯ Ù…Ø³ÙˆØ¯Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠ**: ÙŠÙˆÙ…ÙŠØ§Ù‹ Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù…Ù‡Ù…Ø©
- **Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª**: ÙƒÙ„ Ø³Ø§Ø¹Ø©
- **ØªØ®Ø²ÙŠÙ† Ù…Ø¤Ù‚Øª**: ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 15 Ø¯Ù‚ÙŠÙ‚Ø© Ù„Ù„Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©

## ğŸ—ï¸ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„ØªÙ‚Ù†ÙŠØ© - Technical Architecture

### Database Schema

```typescript
// Calendar Events
calendarEvents {
  id: string (PK)
  title: string
  slug: string (unique)
  description: text
  type: GLOBAL | NATIONAL | INTERNAL
  dateStart: date
  dateEnd: date (nullable)
  importance: 1-5
  tags: string[]
  categoryId: string (FK)
  createdById: string (FK)
  createdAt: timestamp
  updatedAt: timestamp
}

// Calendar Reminders
calendarReminders {
  id: string (PK)
  eventId: string (FK)
  fireWhen: number (days before event)
  channels: string[] (IN_APP, EMAIL, WHATSAPP, SLACK)
  message: text
  enabled: boolean
  createdAt: timestamp
}

// Calendar AI Drafts
calendarAiDrafts {
  id: string (PK)
  eventId: string (FK, unique)
  editorialIdeas: json
  headlines: json
  infographicData: json
  socialMedia: json
  seo: json
  createdAt: timestamp
  updatedAt: timestamp
}

// Calendar Assignments
calendarAssignments {
  id: string (PK)
  eventId: string (FK)
  userId: string (FK, nullable)
  role: editor | reporter | designer | social
  status: pending | in_progress | done | cancelled
  notes: text
  createdById: string (FK)
  createdAt: timestamp
  updatedAt: timestamp
}
```

### API Endpoints

#### Events
- `GET /api/calendar` - List events with filters (type, importance, dateFrom, dateTo, tags, search)
- `POST /api/calendar` - Create event (requires: calendar:create)
- `GET /api/calendar/:id` - Get event details
- `PATCH /api/calendar/:id` - Update event (requires: calendar:edit)
- `DELETE /api/calendar/:id` - Delete event (requires: calendar:delete)
- `GET /api/calendar/upcoming` - Get upcoming events (7-day lookahead)

#### Reminders
- `GET /api/calendar/:id/reminders` - Get event reminders
- `POST /api/calendar/:id/reminders` - Create reminder (requires: calendar:create)
- `DELETE /api/calendar/reminders/:id` - Delete reminder (requires: calendar:edit)

#### Assignments
- `GET /api/calendar/:id/assignments` - Get event assignments
- `POST /api/calendar/:id/assignments` - Create assignment (requires: calendar:assign_tasks)
- `PATCH /api/calendar/assignments/:id` - Update assignment (requires: calendar:assign_tasks)
- `DELETE /api/calendar/assignments/:id` - Delete assignment (requires: calendar:assign_tasks)
- `PATCH /api/calendar/assignments/:id/status` - Update status (self or calendar:assign_tasks)

#### AI Generation
- `POST /api/calendar/:id/generate` - Generate AI draft (requires: calendar:generate_ai)
- `GET /api/calendar/:id/ai-draft` - Get cached AI draft
- `POST /api/calendar/:id/create-article-draft` - Create article from event

### Storage Layer

```typescript
interface IStorage {
  // Events
  getCalendarEvents(filters): Promise<CalendarEvent[]>
  getCalendarEventById(id): Promise<CalendarEvent | undefined>
  createCalendarEvent(data): Promise<CalendarEvent>
  updateCalendarEvent(id, data): Promise<CalendarEvent>
  deleteCalendarEvent(id): Promise<void>
  getUpcomingCalendarEvents(days): Promise<CalendarEvent[]>
  
  // Reminders
  getCalendarReminders(eventId): Promise<CalendarReminder[]>
  createCalendarReminder(data): Promise<CalendarReminder>
  deleteCalendarReminder(id): Promise<void>
  getRemindersToFire(date): Promise<CalendarReminderWithEvent[]>
  updateCalendarReminder(id, data): Promise<CalendarReminder>
  
  // AI Drafts
  getCalendarAiDraft(eventId): Promise<CalendarAiDraft | undefined>
  createCalendarAiDraft(data): Promise<CalendarAiDraft>
  updateCalendarAiDraft(eventId, data): Promise<CalendarAiDraft>
  
  // Assignments
  getCalendarAssignments(filters): Promise<CalendarAssignment[]>
  createCalendarAssignment(data): Promise<CalendarAssignment>
  updateCalendarAssignment(id, data): Promise<CalendarAssignment>
  deleteCalendarAssignment(id): Promise<void>
}
```

### AI Service

```typescript
// services/calendarAi.ts
export async function generateCalendarEventIdeas(
  title: string,
  description: string,
  type: string,
  date: Date
): Promise<CalendarAIDraft>

export async function generateArticleDraft(
  eventTitle: string,
  eventDescription: string,
  selectedAngle: string
): Promise<ArticleDraft>
```

### Cron Jobs

```typescript
// jobs/calendar.ts

// Daily at 2:00 AM - Generate AI drafts for high-importance events
autoGenerateAiDrafts: '0 2 * * *'

// Every hour - Process and send reminders
processReminders: '0 * * * *'

// Every 15 minutes - Update upcoming events cache
updateUpcomingEventsCache: '*/15 * * * *'
```

## ğŸ” RBAC Permissions

### Calendar Module Permissions
- `calendar:view` - Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
- `calendar:create` - Ø¥Ù†Ø´Ø§Ø¡ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
- `calendar:edit` - ØªØ¹Ø¯ÙŠÙ„ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
- `calendar:delete` - Ø­Ø°Ù Ø£Ø­Ø¯Ø§Ø« Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
- `calendar:assign_tasks` - ØªØ¹ÙŠÙŠÙ† Ù…Ù‡Ø§Ù… Ø§Ù„ØªÙ‚ÙˆÙŠÙ…
- `calendar:generate_ai` - ØªÙˆÙ„ÙŠØ¯ Ù…Ø­ØªÙˆÙ‰ Ø°ÙƒÙŠ

### Role Mappings
- **system_admin**: All permissions
- **admin**: All calendar permissions
- **editor**: view, create, edit, assign_tasks, generate_ai
- **reporter**: view, create

## ğŸŒ± Seed Data

### 300+ Arabic Occasions Included

#### International (Ø¹Ø§Ù„Ù…ÙŠ)
- UN International Days (Ø£ÙŠØ§Ù… Ø§Ù„Ø£Ù…Ù… Ø§Ù„Ù…ØªØ­Ø¯Ø©)
- WHO Health Days (Ù…Ù†Ø¸Ù…Ø© Ø§Ù„ØµØ­Ø© Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©)
- UNESCO Cultural Days (Ø§Ù„ÙŠÙˆÙ†Ø³ÙƒÙˆ)
- Global awareness days

#### National (ÙˆØ·Ù†ÙŠ)
- Saudi National Occasions
  - Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ (23 Ø³Ø¨ØªÙ…Ø¨Ø±)
  - ÙŠÙˆÙ… Ø§Ù„ØªØ£Ø³ÙŠØ³ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ (22 ÙØ¨Ø±Ø§ÙŠØ±)
  - ÙŠÙˆÙ… Ø§Ù„Ø¹Ù„Ù… Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ (11 Ù…Ø§Ø±Ø³)
  - ÙŠÙˆÙ… Ø¨ÙŠØ¹Ø© Ø§Ù„Ù…Ù„Ùƒ Ø³Ù„Ù…Ø§Ù† (3 Ø£Ø¨Ø±ÙŠÙ„)
- GCC National Days
  - Ø§Ù„Ø¥Ù…Ø§Ø±Ø§ØªÙŠØŒ Ø§Ù„Ù‚Ø·Ø±ÙŠØŒ Ø§Ù„Ø¨Ø­Ø±ÙŠÙ†ÙŠØŒ Ø§Ù„ÙƒÙˆÙŠØªÙŠØŒ Ø§Ù„Ø¹Ù…Ø§Ù†ÙŠ
- Saudi Seasons & Festivals
  - Ù…ÙˆØ³Ù… Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ù…ÙˆØ³Ù… Ø¬Ø¯Ø©
  - Ù…Ø¹Ø±Ø¶ Ø§Ù„ÙƒØªØ§Ø¨ØŒ Ù…Ù‡Ø±Ø¬Ø§Ù† Ø§Ù„Ø£ÙÙ„Ø§Ù…
  - Ù…Ù†ØªØ¯Ù‰ Ù…Ø¨Ø§Ø¯Ø±Ø© Ù…Ø³ØªÙ‚Ø¨Ù„ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±

#### Technology & Business (ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù‚ØªØµØ§Ø¯)
- CES, MWC, Google I/O, Apple WWDC
- Computex, Davos Forum

#### Sports (Ø±ÙŠØ§Ø¶Ø©)
- Ø±Ø§Ù„ÙŠ Ø¯Ø§ÙƒØ§Ø± Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©
- Ø§Ù„Ø¯Ø±Ø¹ÙŠØ© Ù„Ù„ÙÙˆØ±Ù…ÙˆÙ„Ø§ Ø¥ÙŠ
- Ø¨Ø·ÙˆÙ„Ø§Øª Ø¹Ø§Ù„Ù…ÙŠØ©

#### Cultural (Ø«Ù‚Ø§ÙØ© ÙˆÙÙ†)
- Oscars, Grammy, Cannes, Venice
- Art Dubai, Biennale

#### Internal (Ø¯Ø§Ø®Ù„ÙŠ)
- Editorial meetings
- Training workshops
- Marketing campaigns
- Report deadlines

## ğŸ“ Usage Example

### Create Event with Reminders

```typescript
// Create event
const event = await storage.createCalendarEvent({
  title: "Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ",
  description: "Ø°ÙƒØ±Ù‰ ØªÙˆØ­ÙŠØ¯ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©",
  type: "NATIONAL",
  dateStart: new Date("2025-09-23"),
  importance: 5,
  tags: ["Ø³Ø¹ÙˆØ¯ÙŠØ©", "ÙˆØ·Ù†ÙŠ", "Ø§Ø­ØªÙØ§Ù„"],
  categoryId: "...",
  createdById: "..."
});

// Add reminder
await storage.createCalendarReminder({
  eventId: event.id,
  fireWhen: 7, // 7 days before
  channels: ["IN_APP", "EMAIL"],
  message: "Ø§Ù‚ØªØ±Ø§Ø¨ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ÙˆØ·Ù†ÙŠ Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠ - Ø¬Ù‡Ø² Ø®Ø·Ø© Ø§Ù„ØªØºØ·ÙŠØ©",
  enabled: true
});
```

### Generate AI Content

```typescript
// Generate AI draft
const response = await fetch(`/api/calendar/${eventId}/generate`, {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' }
});

const aiDraft = await response.json();
// aiDraft contains: editorialIdeas, headlines, infographicData, socialMedia, seo
```

### Assign Tasks

```typescript
// Assign to reporter
await storage.createCalendarAssignment({
  eventId: event.id,
  userId: reporterId,
  role: "reporter",
  status: "pending",
  notes: "ÙƒØªØ§Ø¨Ø© ØªÙ‚Ø±ÙŠØ± Ø´Ø§Ù…Ù„ Ø¹Ù† Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ§Øª",
  createdById: editorId
});

// Assign to designer
await storage.createCalendarAssignment({
  eventId: event.id,
  userId: designerId,
  role: "designer",
  status: "pending",
  notes: "ØªØµÙ…ÙŠÙ… Ø¥Ù†ÙÙˆØ¬Ø±Ø§ÙÙŠÙƒ Ø§Ø­ØªÙØ§Ù„ÙŠ",
  createdById: editorId
});
```

## ğŸš€ Getting Started

### 1. Run Database Migrations
```bash
npm run db:push
```

### 2. Seed RBAC Permissions
```bash
npm run seed
```

### 3. Seed Calendar Data
```typescript
import { seedCalendarEvents } from './server/scripts/seedCalendar';
await seedCalendarEvents();
```

### 4. Start Calendar Jobs
```typescript
import { startCalendarJobs } from './server/jobs/calendar';
startCalendarJobs();
```

## ğŸ”„ Integration Points

### With Existing Systems
- **Articles**: Create article drafts from calendar events
- **Notifications**: Send reminders via notification engine
- **Categories**: Link events to content categories
- **RBAC**: Full permission control
- **Activity Logs**: All actions logged

### OpenAI Integration
- Uses GPT-4 model for Arabic content generation
- Structured JSON outputs
- Context-aware prompts for Saudi/Arab audience

## ğŸ“Š Performance Considerations

- **Caching**: In-memory cache for upcoming events (15-min refresh)
- **Batch Processing**: AI draft generation runs off-peak (2 AM)
- **Rate Limiting**: 2-second delay between AI requests
- **Database Indexes**: On dateStart, type, importance for fast queries

## ğŸ”® Future Enhancements

- [ ] CSV/ICS import functionality
- [ ] Export to calendar formats (iCal, Google Calendar)
- [ ] WhatsApp/Slack reminder integration
- [ ] Calendar view frontend UI
- [ ] Analytics dashboard
- [ ] Recurring events support
- [ ] Calendar templates
- [ ] Multi-language support

## ğŸ“„ License

Part of Sabq News Platform - All Rights Reserved

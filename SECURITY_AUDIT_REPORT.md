# ุชูุฑูุฑ ุงูุชูููู ุงูุฃููู ุงูุดุงูู - ููุตุฉ ุณุจู ุงูุฅุฎุจุงุฑูุฉ
**ุชุงุฑูุฎ ุงูุชูููู:** 15 ุฏูุณูุจุฑ 2025

---

## ููุฎุต ุชูููุฐู

ุชู ุฅุฌุฑุงุก ุชูููู ุฃููู ุดุงูู ูููุตุฉ ุณุจู ุงูุฅุฎุจุงุฑูุฉ ุงูุฐููุฉ. ูุบุทู ูุฐุง ุงูุชูุฑูุฑ ุชุญููู ุงูุจููุฉ ุงูุชุญุชูุฉ ุงูุฃูููุฉุ ุงุฎุชุจุงุฑ ุงูุซุบุฑุงุช ุงูุจุฑูุฌูุฉุ ูุฑุงุฌุนุฉ ุณูุงุณุงุช ุงูุฃูุงูุ ูุชุญููู ุฅุฏุงุฑุฉ ุงููููุฉ ูุงูุตูุงุญูุงุช.

### ุงูุชูููู ุงูุนุงู: โ๏ธ ูุชุทูุจ ุชุญุณููุงุช

---

## 1. ุงูุซุบุฑุงุช ุงูุญุฑุฌุฉ (Critical)

### 1.1 ุซุบุฑุฉ ุญูู SQL (SQL Injection)
**ุงูุฎุทูุฑุฉ:** ๐ด ุญุฑุฌุฉ  
**ุงูููู:** `server/services/adsAnalytics.ts`  
**ุงูุฃุณุทุฑ:** 206, 214-218, 227, 235-239

**ุงููุตู:**
ูุณุชุฎุฏู ุงูููุฏ `sql.raw(dateTrunc)` ุญูุซ ูุชู ุชูุฑูุฑ ูููุฉ `dateTrunc` ูู ูุฏุฎูุงุช ุงููุณุชุฎุฏู (ูุนุงูู `period`) ุฏูู ุชุญูู ูุงูู.

```typescript
// ุงูููุฏ ุงูููุนุฑููุถ ููุฎุทุฑ
dateBucket: sql<string>`date_trunc('${sql.raw(dateTrunc)}', ${impressions.timestamp})::date::text`,
```

**ุงูุชุฃุซูุฑ:**
- ูููู ููููุงุฌู ุชูููุฐ ุฃูุงูุฑ SQL ุนุดูุงุฆูุฉ
- ุงููุตูู ุบูุฑ ุงููุตุฑุญ ุจู ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุชุนุฏูู ุฃู ุญุฐู ุงูุจูุงูุงุช

**ุงูุญู ุงููููุชุฑุญ:**
```typescript
// ุงุณุชุฎุฏุงู ูุงุฆูุฉ ุจูุถุงุก ููููู ุงููุณููุญุฉ
const ALLOWED_PERIODS = ['day', 'week', 'month'] as const;
type ValidPeriod = typeof ALLOWED_PERIODS[number];

function getDateTrunc(period: string): ValidPeriod {
  if (!ALLOWED_PERIODS.includes(period as ValidPeriod)) {
    return 'day'; // ุงููููุฉ ุงูุงูุชุฑุงุถูุฉ ุงูุขููุฉ
  }
  return period as ValidPeriod;
}
```

---

### 1.2 ุบูุงุจ ุญูุงูุฉ CSRF
**ุงูุฎุทูุฑุฉ:** ๐ด ุญุฑุฌุฉ  
**ุงููุทุงู:** ุฌููุน ูุณุงุฑุงุช POST/PUT/DELETE

**ุงููุตู:**
ูุง ุชูุฌุฏ ุขููุฉ ุญูุงูุฉ ูู ูุฌูุงุช CSRF (Cross-Site Request Forgery) ุฑุบู ุงุณุชุฎุฏุงู ุงููุตุงุฏูุฉ ุนุจุฑ ุงูุฌูุณุงุช.

**ุงูุชุฃุซูุฑ:**
- ูููู ููููุงุฌู ุชูููุฐ ุฅุฌุฑุงุกุงุช ููุงุจุฉ ุนู ุงููุณุชุฎุฏู ุงููุตุงุฏู
- ุชุนุฏูู ุจูุงูุงุช ุงููุณุชุฎุฏู ุฏูู ุนููู
- ูุดุฑ ููุงูุงุช ุฃู ุชุนูููุงุช ุจุงุณู ุงููุณุชุฎุฏู

**ุงูุญู ุงููููุชุฑุญ:**
```typescript
// ุชุซุจูุช ุญุฒูุฉ csurf
import csrf from 'csurf';

const csrfProtection = csrf({ cookie: true });

// ุชุทุจูู ุนูู ุงููุณุงุฑุงุช ุงูุญุณุงุณุฉ
app.post('/api/articles', csrfProtection, (req, res) => {
  // ...
});

// ุฅุฑุณุงู ุงูุฑูุฒ ูููุงุฌูุฉ ุงูุฃูุงููุฉ
app.get('/api/csrf-token', csrfProtection, (req, res) => {
  res.json({ csrfToken: req.csrfToken() });
});
```

---

## 2. ุงูุซุบุฑุงุช ุนุงููุฉ ุงูุฎุทูุฑุฉ (High)

### 2.1 ุซุบุฑุงุช XSS (Cross-Site Scripting)
**ุงูุฎุทูุฑุฉ:** ๐ ุนุงููุฉ  
**ุงููููุงุช ุงููุชุฃุซุฑุฉ:**
- `client/src/examples/ArticleVoiceCommandsExample.tsx` (ุณุทุฑ 58)
- `client/src/components/AdSlot.tsx` (ุณุทุฑ 158)
- `client/src/components/lite/SwipeCard.tsx` (ุณุทุฑ 601)
- `client/src/pages/ai/AIArticleDetail.tsx` (ุณุทุฑ 419)
- `client/src/components/EmailDetailsModal.tsx` (ุณุทุฑ 123)

**ุงููุตู:**
ุงุณุชุฎุฏุงู `dangerouslySetInnerHTML` ุจุฏูู ุชุนููู ุงููุญุชูู ุจุงุณุชุฎุฏุงู DOMPurify.

```tsx
// ููุฏ ุบูุฑ ุขูู
dangerouslySetInnerHTML={{ __html: article.content }}

// ููุฏ ุขูู (ูุณุชุฎุฏู ูู ุจุนุถ ุงููููุงุช)
dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(article.content) }}
```

**ุงูุชุฃุซูุฑ:**
- ุญูู ุฃููุงุฏ JavaScript ุฎุจูุซุฉ
- ุณุฑูุฉ ุจูุงูุงุช ุงูุฌูุณุฉ
- ุชูููุฐ ุฅุฌุฑุงุกุงุช ุจุงุณู ุงููุณุชุฎุฏู

**ุงูุญู ุงููููุชุฑุญ:**
ุชูุญูุฏ ุงุณุชุฎุฏุงู DOMPurify ูู ุฌููุน ุงูุฃูุงูู:
```tsx
import DOMPurify from 'isomorphic-dompurify';

// ุฅูุดุงุก ูููู ูุณุงุนุฏ ุขูู
function SafeHTML({ html }: { html: string }) {
  return <div dangerouslySetInnerHTML={{ __html: DOMPurify.sanitize(html) }} />;
}
```

---

## 3. ุงูุซุบุฑุงุช ูุชูุณุทุฉ ุงูุฎุทูุฑุฉ (Medium)

### 3.1 ุชุณุฌูู ูุนูููุงุช ุญุณุงุณุฉ
**ุงูุฎุทูุฑุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููู:** `server/routes.ts`  
**ุงูุณุทุฑ:** 442

**ุงููุตู:**
```typescript
console.log("๐ Login attempt:", { email: req.body?.email, hasPassword: !!req.body?.password });
```

**ุงูุชุฃุซูุฑ:**
- ูุฏ ููููููู ูู ุชุญููู ุงูุณุฌูุงุช ูุงุณุชูุชุงุฌ ูุฌูุฏ ูููุฉ ูุฑูุฑ
- ูุฎุงุทุฑ ูู ุญุงูุฉ ุชุณุฑูุจ ุงูุณุฌูุงุช

**ุงูุญู ุงููููุชุฑุญ:**
```typescript
// ูู ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ ููุท
if (process.env.NODE_ENV !== 'production') {
  console.log("๐ Login attempt for:", req.body?.email);
}
```

### 3.2 ุฑุงุจุท ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูู ุงูุณุฌูุงุช
**ุงูุฎุทูุฑุฉ:** ๐ก ูุชูุณุทุฉ  
**ุงูููู:** `server/routes.ts.backup`  
**ุงูุณุทุฑ:** 678

**ุงููุตู:**
ุชุณุฌูู ุฑุงุจุท ุฅุนุงุฏุฉ ุชุนููู ูููุฉ ุงููุฑูุฑ ูู ุงูุณุฌูุงุช.

**ุงูุญู:** ุฅุฒุงูุฉ ูุฐุง ุงูุชุณุฌูู ูู ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ.

---

## 4. ููุงุท ุงูููุฉ ุงูุฃูููุฉ โ

### 4.1 ุงููุตุงุฏูุฉ ูุฅุฏุงุฑุฉ ุงูุฌูุณุงุช
- โ ุงุณุชุฎุฏุงู bcrypt ูุชุดููุฑ ูููุงุช ุงููุฑูุฑ (salt rounds: 10)
- โ ุฅุนุฏุงุฏุงุช ุงูุฌูุณุฉ ุขููุฉ:
  - `httpOnly: true` - ุญูุงูุฉ ูู ุณุฑูุฉ ุงูุฌูุณุฉ ุนุจุฑ JavaScript
  - `secure: true` ูู ุงูุฅูุชุงุฌ - ููู ุนุจุฑ HTTPS ููุท
  - `sameSite: 'strict'` - ุญูุงูุฉ ุฌุฒุฆูุฉ ูู CSRF
  - ูุฏุฉ ุงูุฌูุณุฉ: 7 ุฃูุงู
- โ ุฏุนู ุงููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ (2FA) ุนุจุฑ TOTP
- โ ุฃููุงุฏ ุงุญุชูุงุทูุฉ ูููุตุงุฏูุฉ ุงูุซูุงุฆูุฉ

### 4.2 ุงูุชุญูู ูู ุงููุตูู (RBAC)
- โ ูุธุงู ุตูุงุญูุงุช ูุงุฆู ุนูู ุงูุฃุฏูุงุฑ
- โ ูุตู ุงูุตูุงุญูุงุช (admin, editor, reporter, reader)
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูุจู ูู ุนูููุฉ ุญุณุงุณุฉ
- โ ุชุณุฌูู ุงูุฃูุดุทุฉ (Activity Logging)

### 4.3 ุฑุคูุณ ุงูุฃูุงู (Security Headers)
- โ ุงุณุชุฎุฏุงู Helmet.js ูุน ุฅุนุฏุงุฏุงุช ุดุงููุฉ:
  - Content-Security-Policy
  - HSTS (max-age: 1 year, includeSubDomains, preload)
  - X-Content-Type-Options: nosniff
  - X-XSS-Protection
  - Referrer-Policy: strict-origin-when-cross-origin

### 4.4 ุชุญุฏูุฏ ูุนุฏู ุงูุทูุจุงุช (Rate Limiting)
- โ ุชุญุฏูุฏ ุนุงู: 500 ุทูุจ / 15 ุฏูููุฉ
- โ ุชุญุฏูุฏ ุชุณุฌูู ุงูุฏุฎูู: 5 ูุญุงููุงุช / 15 ุฏูููุฉ
- โ ุชุญุฏูุฏ ุตุงุฑู ููุนูููุงุช ุงูุญุณุงุณุฉ: 10 ุทูุจุงุช / 15 ุฏูููุฉ

### 4.5 CORS
- โ ูุงุฆูุฉ ุจูุถุงุก ูููุทุงูุงุช ุงููุณููุญุฉ
- โ ุฏุนู credentials ูููุตุงุฏูุฉ
- โ ุชุญุฏูุฏ ุงูุทุฑู ุงููุณููุญุฉ

### 4.6 ุฃูุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุงุณุชุฎุฏุงู Drizzle ORM ูุน ุงุณุชุนูุงูุงุช ููุนุงููุฉ (parameterized)
- โ ุงุชุตุงู ุขูู ุนุจุฑ SSL
- โ ุฅุนุฏุงุฏุงุช pool ูุญุณููุฉ

---

## 5. ุงูุชูุตูุงุช ุงูุนุงุฌูุฉ

### ุงูุฃููููุฉ ุงููุตูู (ุฎูุงู 24 ุณุงุนุฉ):
1. **ุฅุตูุงุญ ุซุบุฑุฉ SQL Injection** ูู `adsAnalytics.ts`
2. **ุชุทุจูู ุญูุงูุฉ CSRF** ุนูู ุฌููุน ุงููุณุงุฑุงุช ุงูุญุณุงุณุฉ

### ุงูุฃููููุฉ ุงูุนุงููุฉ (ุฎูุงู ุฃุณุจูุน):
3. **ุชูุญูุฏ ุชุนููู XSS** ุจุงุณุชุฎุฏุงู DOMPurify ูู ุฌููุน ุงูุฃูุงูู
4. **ุฅุฒุงูุฉ ุชุณุฌูู ุงููุนูููุงุช ุงูุญุณุงุณุฉ** ูู ุงูุจูุฆุฉ ุงูุฅูุชุงุฌูุฉ

### ุงูุฃููููุฉ ุงููุชูุณุทุฉ (ุฎูุงู ุดูุฑ):
5. ุฅุถุงูุฉ Content-Security-Policy ุฃูุซุฑ ุตุฑุงูุฉ
6. ุชุทุจูู ุชุดููุฑ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
7. ุฅุนุฏุงุฏ ูุธุงู ูุฑุงูุจุฉ ุงูุฃุญุฏุงุซ ุงูุฃูููุฉ

---

## 6. ููุฎุต ุงูุซุบุฑุงุช

| ุงูุฎุทูุฑุฉ | ุงูุนุฏุฏ | ุงูุญุงูุฉ |
|---------|-------|--------|
| ุญุฑุฌุฉ | 2 | โ๏ธ ูุชุทูุจ ุฅุตูุงุญ ููุฑู |
| ุนุงููุฉ | 1 | โ๏ธ ูุชุทูุจ ุฅุตูุงุญ ูุฑูุจ |
| ูุชูุณุทุฉ | 2 | ๐ถ ูุชุทูุจ ูุฑุงุฌุนุฉ |
| ููุฎูุถุฉ | 0 | - |

---

## 7. ุงูุฎุงุชูุฉ

ุงูููุตุฉ ุชุชูุชุน ุจุฃุณุงุณ ุฃููู ููู ูู ูุฌุงูุงุช ุงููุตุงุฏูุฉ ูุฅุฏุงุฑุฉ ุงูุฌูุณุงุช ูุงูุชุญูู ูู ุงููุตูู. ููุน ุฐููุ ููุงู ุซุบุฑุงุช ุญุฑุฌุฉ ุชุชุทูุจ ูุนุงูุฌุฉ ููุฑูุฉุ ุฎุงุตุฉ:

1. ุซุบุฑุฉ ุญูู SQL ูู ุชุญูููุงุช ุงูุฅุนูุงูุงุช
2. ุบูุงุจ ุญูุงูุฉ CSRF
3. ุนุฏู ุงุชุณุงู ุชุนููู ูุญุชูู HTML

ูููุตุญ ุจูุนุงูุฌุฉ ูุฐู ุงูุซุบุฑุงุช ุจุฃุณุฑุน ููุช ูููู ูุฅุฌุฑุงุก ูุฑุงุฌุนุฉ ุฃูููุฉ ุฏูุฑูุฉ.

---

**ุชู ุฅุนุฏุงุฏ ูุฐุง ุงูุชูุฑูุฑ ุจูุงุณุทุฉ:** ูุธุงู ุงูุชูููู ุงูุฃููู ุงูุขูู  
**ุงูุชุงุฑูุฎ:** 15 ุฏูุณูุจุฑ 2025

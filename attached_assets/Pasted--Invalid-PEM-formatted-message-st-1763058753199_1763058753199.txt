## ğŸ¯ **Ø§Ù„Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©: Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© ØªØ§Ù„Ù**

Ø§Ù„Ø®Ø·Ø£ `Invalid PEM formatted message` Ù…Ø¹Ù†Ø§Ù‡ Ø¥Ù† Ø§Ù„Ù€ string Ø£ØµØ¨Ø­Øª **string** Ù„ÙƒÙ† **Ø§Ù„Ù…Ø­ØªÙˆÙ‰** ÙÙŠÙ‡ Ù…Ø´ÙƒÙ„Ø©. Ø§Ù„Ù…ÙƒØªØ¨Ø© ØªØ³ØªØ®Ø¯Ù… `node-forge` ÙˆÙ…Ø§ ØªÙ‚Ø¯Ø± ØªÙ‚Ø±Ø£ Ø§Ù„Ù€ PEM.

### **Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø­ØªÙ…Ù„**

Ø£Ù†Øª ØªØ­ÙˆÙ‘Ù„ Ø§Ù„Ù€ Buffer Ø¥Ù„Ù‰ string Ø¨Ù€ `toString('ascii')` Ø£Ùˆ `toString('utf-8')`ØŒ Ù„ÙƒÙ† **Ø§Ù„Ù€ Buffer Ù†ÙØ³Ù‡ ÙƒØ§Ù† ØªØ§Ù„Ù** Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø§Ù„Ù€ base64 decoding Ø®Ø§Ø·Ø¦).

---

## âœ… **Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø®Ø·ÙˆØ§Øª base64**

### **Ø§Ù„Ø®Ø·ÙˆØ© 1: ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù€ Env Var**

Ø§Ù„Ù€ **Env Var** ÙŠØ¬Ø¨ ÙŠÙƒÙˆÙ† **base64 string ØµØ­ÙŠØ­** (Ø¨Ø¯ÙˆÙ† Ø£Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯Ø©ØŒ Ø¨Ø¯ÙˆÙ† Ù…Ø³Ø§ÙØ§Øª).

Ù„Ùˆ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© `certificate.pem`ØŒ Ø­ÙˆÙ‘Ù„Ù‡Ø§ Ø¨Ù€:
```bash
# Ø·Ø±ÙŠÙ‚Ø© ØµØ­ÙŠØ­Ø©
cat certificate.pem | base64 | tr -d '\n'
```

### **Ø§Ù„Ø®Ø·ÙˆØ© 2: Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµØ­ÙŠØ­ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯**

ÙÙŠ `PassKitService.ts`ØŒ Ø§Ø³ØªØ®Ø¯Ù… **Buffer.from** Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©:

```typescript
private loadCertificates() {
  // ğŸ”¥ Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
  
  // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ù…Ù„Ù (Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯)
  const wwdrPath = '/home/runner/workspace/certs/wwdr.pem';
  const wwdrPem = readFileSync(wwdrPath, 'utf-8'); // Ù‚Ø±Ø§Ø¡Ø© Ù…Ø¨Ø§Ø´Ø±Ø© ÙƒÙ€ String
  
  // Ø£Ùˆ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† env var (Ø¥Ø°Ø§ Ù…Ø­ÙÙˆØ¸ ÙƒÙ€ base64)
  const signerCertBase64 = process.env.APPLE_LOYALTY_PASS_CERT!;
  const signerKeyBase64 = process.env.APPLE_LOYALTY_PASS_KEY!;
  
  // ØªØ­ÙˆÙŠÙ„ base64 Ø¥Ù„Ù‰ PEM String (Ù…Ù‡Ù…!)
  const signerCertPem = Buffer.from(signerCertBase64, 'base64').toString('utf-8');
  const signerKeyPem = Buffer.from(signerKeyBase64, 'base64').toString('utf-8');
  
  // âœ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© PEM
  this.validatePem(wwdrPem, 'WWDR');
  this.validatePem(signerCertPem, 'Signer Cert');
  this.validatePem(signerKeyPem, 'Signer Key');
  
  return {
    wwdr: wwdrPem,
    signerCert: signerCertPem,
    signerKey: signerKeyPem,
    signerKeyPassphrase: process.env.APPLE_PASS_KEY_PASSPHRASE
  };
}

private validatePem(pem: string, name: string) {
  if (!pem.includes('-----BEGIN')) {
    throw new Error(`âŒ ${name} PEM is invalid: Missing BEGIN header`);
  }
  if (!pem.includes('-----END')) {
    throw new Error(`âŒ ${name} PEM is invalid: Missing END footer`);
  }
  // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ø£Ø­Ø±Ù ØºÙŠØ± ØµØ§Ù„Ø­Ø©
  const cleaned = pem.replace(/\r/g, '\n').trim();
  if (cleaned.length < 500) {
    throw new Error(`âŒ ${name} PEM is too short: ${cleaned.length} chars`);
  }
  console.log(`âœ… ${name} PEM is valid, length: ${cleaned.length}`);
}
```

---

## ğŸ”¥ **Ø§Ù„Ø­Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ Ù„Ù€ Replit**

Ø¥Ø°Ø§ Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© ÙÙŠ Ù…Ù„ÙØ§Øª `.pem` Ù…Ø¨Ø§Ø´Ø±Ø©ØŒ **Ø§Ø³ØªØ®Ø¯Ù…Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©**:

```typescript
import { readFileSync } from 'fs';

private loadCertificates() {
  // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„Ù…Ù„ÙØ§Øª
  const certs = {
    wwdr: readFileSync('/home/runner/workspace/certs/wwdr.pem', 'utf-8'),
    signerCert: readFileSync('/home/runner/workspace/certs/loyalty-cert.pem', 'utf-8'),
    signerKey: readFileSync('/home/runner/workspace/certs/loyalty-key.pem', 'utf-8'),
    signerKeyPassphrase: process.env.APPLE_PASS_KEY_PASSPHRASE
  };
  
  // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø³Ø±ÙŠØ¹
  console.log('âœ… Certificates loaded from files:', {
    wwdr: certs.wwdr.substring(0, 50) + '...'
  });
  
  return certs;
}
```

---

## ğŸš€ **Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ø§Ù„Ø¢Ù†**

1. **Ø§Ø­Ø°Ù Ø§Ù„Ù€ Env Vars** Ù…Ù† Ø§Ù„Ø´Ù‡Ø§Ø¯Ø§Øª (Ø¥Ø°Ø§ ÙÙŠÙ‡Ø§ Ù…Ø´ÙƒÙ„Ø©)
2. **Ø­Ù…Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª `.pem`** Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù…Ø¬Ù„Ø¯ `certs/`
3. **Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£Ø®ÙŠØ±** Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©
4. **Ø£Ø¹Ø¯ Ø§Ù„Ø¨Ù†Ø§Ø¡** ÙˆØ§Ø·Ù„Ø¨ Ù…Ù†ÙŠ Ù„Ùˆ Ø¸Ù‡Ø± Ø®Ø·Ø£ Ø¬Ø¯ÙŠØ¯

**Ù‡Ø°Ø§ Ø±Ø§Ø­ ÙŠØ¶Ù…Ù† 100% Ø¥Ù† Ø§Ù„Ù€ PEM ØµØ­ÙŠØ­!** ğŸ’¯
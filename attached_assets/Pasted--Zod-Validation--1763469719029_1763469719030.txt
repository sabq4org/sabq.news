ุฃุจู ูุญููุฏโฆ ูุง ุจุทูโฆ
ุงูุตูุฑุฉ ุงููู ุฃุฑุณูุชูุง ุชูุดู ุงูุฎุทุฃ ุงูุญูููู ุจุดูู ูุงุถุญ ุฌุฏูุงุ ููู ุฎุทุฃ Zod Validation ุฏุงุฎู ุงูู APIโnot UI.

ูุฎูููู ุฃุดุฑุญ ูู ุงูููุถูุน ุจุดูู ุงุญุชุฑุงููุ ูุจุงุดุฑุ ูุจุฃุณููุจ ุฒูุฏ ุฎููู ุงูุฏู ูุงูุนุงุฏุฉ ๐๐ฅ

โธป

๐ฏ ุณุจุจ ุงูุฎุทุฃ (ุจุดูู ูุฎุชุตุฑ ููุงุถุญ):

ุงูู API Endpoint ุงููู ุฃูุช ุชุญุงูู ุชุณุชุฎุฏูู ูุชุทูุจ ุญูู userId
ููู ุงููุงุฌูุฉ (ุงูู UI) ูุง ุชุฑุณูู โ ููุทูุน:

error: "Validation error"
details: {
  issues: [
    {
      code: "invalid_type",
      expected: "string",
      received: "undefined",
      path: ["userId"],
      message: "Required"
    }
  ]
}
name: "ZodError"

ูุฐุง ูุนูุงู:

โ ุงูู API ูุณุชูุจู userId ููู ุงููููุฐุฌ ูุง ูุฑุณูู

ูุงูู backend ูุนุชุจุฑ ุงูุทูุจ ุบูุฑ ุตุงูุญ โ ููุฑุฌุน 400.

โธป

๐ ููุด ุงููููุฐุฌ ูุง ูุฑุณู userIdุ

ูุฐุง ุงูุณููุงุฑูู ูุญุตู ุบุงูุจุงู ูู ุญุงูุชูู:

1) โ ุงููููุฐุฌ ูุง ููุฑูุฑ userId ูู ุงูู logged-in user

ูุน ุฃูู ูุงุฒู ูุฑุณู:

{
  userId: "admin-sabq",
  name: "...",
  phone: "...",
  ...
}

ููู ุงูุขู ุงููู ูุตูุฑ:

userId = undefined

ููุฐุง ุงููู ูุฌูุฑ Zod.

โธป

2) โ API ุฌุฏูุฏ ุฃุถูุชู ูุชุทูุจ userId ููู ุงููุงุฌูุฉ ูู ูุชู ุชุญุฏูุซูุง

ุบุงูุจุงู ุฃูุช ุฃุถูุช:

userId: z.string().min(1)

ููู ุงููุงุฌูุฉ ูุณู ูุง ุชุฑุณู ูุงููุนูููุฉ.

โธป

๐งจ ููู ุงููุดููุฉ ูู ุงูููุฏุ

ุงููุดููุฉ ุบุงูุจุงู ูู ููู ุงูู API ุงูุฎุงุต ุจุฅูุดุงุก ุงูู WhatsApp Token ุฃู Agentุ ุดูุก ุฒู:

/api/social/whatsapp/create
ุฃู:
/api/agents/whatsapp/create

ูููู Zod schema ูุซู:

const schema = z.object({
  userId: z.string().min(1),
  name: z.string().min(1),
  phone: z.string().min(5),
  autoPublish: z.boolean(),
  languages: z.array(z.string())
});

ููู ุงููุงุฌูุฉ ุชุฑุณู:

{
  name: "ุนูู ุงูุญุงุฒูู",
  phone: "966564255999+",
  autoPublish: false,
  languages: ["ar"]
}

ููุง ููู userId.

โธป

๐งฐ ุงูุญู ุงูููุงุฆู (ุงุฎุชุฑ ูุงุญุฏ ูู ุงูุซูุงุซุฉ):

โ ุญู 1 โ ุงูุฃูุถู:

ุฎูู ุงููุงุฌูุฉ ุชุฑุณู userId ูู ุงูู logged-in user.

ูู React:

const payload = {
  userId: session.user.id,
  name,
  phone,
  autoPublish,
  languages
};

ููุฐุง ูุญู ุงููุดููุฉ 100%.

โธป

โ ุญู 2 โ ุณุฑูุน ูุคูุช:

ุฎูู ุงูู backend ูู ุงููู ูุณุชุฎุฑุฌ userId ูู ุงูุฌูุณุฉ ุจุฏู ูุง ูุณุชูุจููุง.

ูู ุงูู API:

const userId = req.user?.id; // ูู Auth Middleware

ุซู:

schema.parse({
  userId,
  name: body.name,
  phone: body.phone,
  autoPublish: body.autoPublish,
  languages: body.languages
});

ูุฐุง ูุบููู ุนู ุฅุฑุณุงู userId ูู ุงููุงุฌูุฉ.

โธป

โ ุญู 3 โ ุฅุฐุง ุชุจุบู ุชูุงุฏู userId ุจุงููุงูู:

ูู Zod schema:

ุบููุฑ:

userId: z.string()

ุฅูู:

userId: z.string().optional()

ููู ูู ุฃูุตุญ ููู ุฅุฐุง ุงูุฎุฏูุฉ ูุฑุชุจุทุฉ ุจุญุณุงุจ ูุณุชุฎุฏู.

โธป

๐ฏ๏ธ ููุฎุต ุณุฑูุน ูุง ุฃุจู ูุญูุฏ:

ุงูุฎุทุฃ ูู ูู Twilio
ูู ูู WhatsApp
ูู ูู ุงููุงุชู
ููู ูู ุงูุญููู ุงููู ุนุจูุชูุง

ุงูุฎุทุฃ ูู ุงููุงุฌูุฉ ุงููู ูุง ุชุฑุณู userId ููู backend.

ูุงูู backend ูููู ูู:

โูุง ุงุณุชููุช userId โ ููุง ุฃุฏุฑู ูู ูู ุงููุณุชุฎุฏู!โ

โธป

๐ ุฃุจูู ุชุฑุณู ูู ุงูุขู:
	1.	ุงุณู ุงูู API ุงููู ุชุณุชุฏุนูู (ุงููุณุงุฑ)
	2.	ุงูู Schema ูู ููู Zod
	3.	ุฌุฒุก ุงููุงุฌูุฉ ุงููู ูุฑุณู ุงูุทูุจ

ูุฃุฑุชุจ ูู ุงูููุฏ ุจุงููุงูู ุฎูุงู ุฏูุงุฆู ๐๐ฅ
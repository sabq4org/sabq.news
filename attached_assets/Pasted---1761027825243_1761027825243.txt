أكيد نقدر يا أبو محمد — ومو بس نقدر، نقدر نسويها “محبوكة” مع التوصيات والإشعارات والبروفايل ✨
تحتك حزمة جاهزة (مخطط DB + APIs + تدفّق الأحداث + واجهة + برومبتات للـAI) تركّبها مباشرة في “سبق الذكية”.

1) المخطط السريع للفكرة
	•	القارئ يضغط “متابعة كلمة” على أي Keyword.
	•	ننشئ اشتراك متابعة لهالكلمة.
	•	أي خبر جديد يحمل نفس الكلمة → يدخل تلقائيًا في:
	1.	توصيات المستخدم (رفع وزن التوافق).
	2.	إشعار ذكي “نُشر خبر جديد حول: <الكلمة>”.
	•	في “بروفايلي” يلقى قائمة الكلمات اللي يتابعها مع زر إلغاء المتابعة.

2) جداول قاعدة البيانات (Drizzle/Supabase)

-- 1) جدول الكلمات (إن لم يكن موجود)
create table if not exists smart_terms (
  id uuid primary key default gen_random_uuid(),
  term text not null unique,
  category text,                 -- politics/economy/sports...
  aliases text[] default '{}',
  usage_count int default 0,
  created_at timestamptz default now()
);

-- 2) متابعة الكلمات
create table if not exists user_followed_terms (
  id uuid primary key default gen_random_uuid(),
  user_id uuid not null references users(id) on delete cascade,
  term_id uuid not null references smart_terms(id) on delete cascade,
  notify boolean default true,          -- يرسل إشعارات؟
  created_at timestamptz default now(),
  unique(user_id, term_id)
);

-- 3) ربط المقالات بالكلمات (إن لم يكن موجود)
create table if not exists article_terms (
  article_id uuid not null references articles(id) on delete cascade,
  term_id uuid not null references smart_terms(id) on delete cascade,
  primary key(article_id, term_id)
);

-- 4) تفضيلات إشعارات (إن لزم ضبط عام)
create table if not exists user_notification_prefs (
  user_id uuid primary key references users(id) on delete cascade,
  keywords_push boolean default true,
  keywords_email boolean default false,
  quiet_hours int4range,  -- مثال: ['23','7') ساعات السكون
  updated_at timestamptz default now()
);

3) نقاط API (Next.js /app/api)
	•	POST /api/keywords/follow
Input: { term: string } → ينشئ/يربط term + سطر في user_followed_terms.
	•	POST /api/keywords/unfollow
Input: { termId: string }
	•	GET /api/keywords/followed
Output: قائمة كلمات المستخدم.
	•	Webhook داخلي للنشر: POST /api/internal/articles/published
Input: { articleId } → يقرأ article_terms، يجيب المتابعين المستهدفين، ويضع مهام إشعار/توصية في الـ Queue.
	•	(اختياري) GET /api/keywords/trending
لإظهار الأكثر تداولًا.

ملاحظات أمان:
	•	RBAC: كل عمليات follow/unfollow تتطلب JWT صالحة.
	•	Rate limit: 30 متابعة/ساعة/مستخدم.
	•	Sanitization للـterm قبل الإنشاء.

4) تدفّق الأحداث (End-to-End)
	1.	المستخدم يضغط “متابعة” على #رالي_داكار.
	2.	API يتحقق من وجود المصطلح، ينشئ/يربط في user_followed_terms.
	3.	عند نشر خبر: خدمة التحرير تربط الخبر بكلماته (article_terms).
	4.	Worker/Queue يلتقط حدث “ArticlePublished”:
	•	يجلب كل المستخدمين اللي يتابعون أي term من Terms الخبر.
	•	يرسل إشعار (Push/Email حسب user_notification_prefs مع احترام quiet_hours).
	•	يحدّث userAffinities: يرفع وزن الاهتمام لهذي الكلمة/التصنيف (مثلاً +0.12 لكل متابعة فعّالة).
	•	يسجّل في recommendationLog.
	5.	تظهر الأخبار ذات الصلة أعلى قائمة التوصيات عند المستخدم.

5) دمجها مع “التوصيات الذكية”
	•	في محرّك الدرجات (Similarity Engine):
أضف عامل جديد keyword_follow_boost (مثال: 15–25% وزن إضافي للمقالات التي تحمل term متابع).
	•	صيغة نهائية للناتج (كمثال):

final_score = 0.4*content_sim + 0.3*collab + 0.2*category_affinity + 0.1*recency
            + keyword_follow_boost  // +0.15 إذا تطابق term متابع

	•	عند follow: سجّل affinity seed للمستخدم تجاه هذا الـterm (userAffinities[term] += 0.3 كبداية، مع decay أسبوعي 0.95).

6) واجهات المستخدم (UI/UX)

زر المتابعة داخل بطاقة الكلمة
	•	Chip أنيقة + حالة (متابع/غير متابع) + Animation خفيف:

<Button
  variant={isFollowing ? "secondary" : "default"}
  onClick={() => toggleFollow(term)}
  className="rounded-full px-3 py-1 text-sm"
>
  {isFollowing ? "إلغاء المتابعة" : "متابعة"}
</Button>

	•	تلميح: اعرض عدّاد المتابعين لكل كلمة “+1.2k يتابعون”.

قائمة الكلمات المتابعة في البروفايل
	•	تبويب: “كلماتي المتابعة”.
	•	Grid من Chips مع (جرس للإشعارات On/Off) و(X) لإلغاء المتابعة.
	•	فرز حسب الأحدث متابعة أو الأكثر نشاطًا.
	•	Empty state لطيف: “تابع كلماتك المفضلة لتصلك إشعارات ذكية عند نشر جديد ✨”.

الوصولية واللمس
	•	حجم لمس ≥ 40px، تباين عالي، دعم RTL كامل، حركات Framer Motion بنسبة بسيطة.

7) إشعارات ذكية (نصوص مقترحة)
	•	Push:
“خبر جديد عن {term}: {title} — شاهد الآن.”
	•	Email Digest (اختياري):
“آخر ما نُشر عن {term}: 3 أخبار مختصرة + روابط”.

8) برومبتات جاهزة للـAI (للاستخراج والتطبيع والإشعار)

A) استخراج وتطبيع الكلمات من نص الخبر

وجّه هذا البرومبت عند حفظ/نشر:

حلّل النص العربي التالي واستخرج منه كلمات مفتاحية قابلة للمتابعة (3–7 كلمات).
أعِدها كـ JSON مصنّف: { term, category, aliases[] }.
راعِ: إزالة التكرار، توحيد الصياغة (مثال: “ولي العهد” ↔ “الأمير محمد بن سلمان”)، وتجنّب الكلمات العامة جدًا.
أعد أيضًا confidence لكل term (0–1) وshouldCreate (boolean) إذا لم يكن موجودًا في قاعدة البيانات.

B) توليد نص الإشعار الذكي

اكتب إشعارًا عربيًا قصيرًا (<90 حرفًا) لخبر يحمل الكلمة المفتاحية {term} وعنوان {title}.
الأسلوب: إعلامي مختصر + دعوة للفعل.
أعِد 3 صيغ، واختر الأقصر.

C) تعزيز التوصيات

لدى المستخدم {userId} قائمة كلمات متابَعة: {terms[]}.
أعِد boost vector لهذه الكلمات بمدى [0.1..0.3] لكل term وفق نشاطها الأسبوعي (views/comments/shares).
أعِده كـ JSON: { term, boost }.

9) كود خادم مختصر (Handlers)

// POST /api/keywords/follow
// body: { term: string }
await ensureTermExists(term); // ينشئ smart_terms إن غاب
await db.insert(user_followed_terms).values({ user_id, term_id }).onConflictDoNothing();
return { ok: true };

// POST /api/internal/articles/published
// body: { articleId }
const terms = await db.select().from(article_terms).where(eq(article_terms.article_id, articleId));
const userIds = await db.selectDistinct(user_followed_terms.user_id)
  .where(inArray(user_followed_terms.term_id, terms.map(t=>t.term_id)).and(eq(user_followed_terms.notify, true)));
await enqueueNotifications(userIds, articleId, terms);
await updateAffinities(userIds, terms); // +boost

10) ضوابط الجودة والتشغيل
	•	Dedup / Merge: توحيد المصطلحات المتشابهة (MBS ↔ محمد بن سلمان) عبر aliases ومرجع canonical_term.
	•	Quiet Hours: تأجيل الدفع إلى خارج نطاق السكون.
	•	Opt-out سريع: من كل إشعار ضع رابط “إيقاف الإشعارات لهذه الكلمة”.
	•	مقاييس: CTR الإشعارات لكل term، نسبة قراءة، إلغاء المتابعة.

⸻

إذا تحب، أجهّز لك:
	1.	Migration جاهزة لـ Drizzle.
	2.	4 Endpoints كاملة (follow/unfollow/list/webhook).
	3.	مكوّن React “FollowKeywordChip” + صفحة “/profile/keywords”.

قول تم وبنزّلها لك بصيغة نسخ-ولصق تناسب هيكلة مشروعك الحالي.
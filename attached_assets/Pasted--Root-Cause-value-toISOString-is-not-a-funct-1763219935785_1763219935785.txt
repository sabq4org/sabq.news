## ğŸ” **ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø³Ø¨Ø¨ ÙˆØ§Ù„Ø­Ù„**

### **Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø¬Ø°Ø±ÙŠ (Root Cause)**
Ø®Ø·Ø£ `value.toISOString is not a function` ÙŠØ­Ø¯Ø« Ù„Ø£Ù† **Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØªÙˆÙ‚Ø¹ ÙƒØ§Ø¦Ù† Date Ù„ÙƒÙ†Ù‡Ø§ ØªÙ„Ù‚Ù‘Øª Ù†Øµ string**.

Ø§Ù„Ø®Ø·Ø£ ÙŠØ£ØªÙŠ Ù…Ù†:
- **Drizzle ORM** ÙÙŠ `PgTimestamp.mapToDriverValue`
- Ø£Ù†Øª ØªÙ…Ø±Ù‘Ø± Ù‚ÙŠÙ…Ø© ØªØ§Ø±ÙŠØ® ÙƒÙ†Øµ string (Ù…Ø«Ù„Ø§Ù‹ "2025-11-15") Ù„ÙƒÙ† Drizzle ÙŠØ­Ø§ÙˆÙ„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ `.toISOString()` Ø¹Ù„ÙŠÙ‡Ø§
- Ù‡Ø°Ø§ ÙŠØ¹Ù†ÙŠ Ø£Ù† **Zod schema ÙŠØ³Ù…Ø­ Ø¨Ù€ string Ù„ÙƒÙ† Drizzle ÙŠØªÙˆÙ‚Ø¹ Date object**

---

### **ğŸ”§ Ø§Ù„Ø­Ù„ÙˆÙ„ Ø§Ù„ÙÙˆØ±ÙŠØ©**

#### **1. ØªØ¹Ø¯ÙŠÙ„ Zod Schema (Ø§Ù„Ø£Ù‡Ù…)**
```typescript
// âŒ Ø®Ø§Ø·Ø¦ - ÙŠØ³Ù…Ø­ Ø¨Ù€ string ÙÙ‚Ø·
const taskSchema = z.object({
  dueDate: z.string(), // Ù‡Ø°Ø§ ÙŠØ¹Ø·Ù‘Ù„ Drizzle
});

// âœ… ØµØ­ÙŠØ­ - Ø­ÙˆÙ‘Ù„ Ø¥Ù„Ù‰ Date
const taskSchema = z.object({
  dueDate: z.string().transform((str) => new Date(str)), // Ø£Ùˆ .datetime()
  // Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ù… Ù‡Ø°Ø§ Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©:
  dueDate: z.string().datetime().transform((str) => new Date(str)),
});
```

#### **2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„**
```typescript
// ÙÙŠ /api/tasks POST handler
console.log("ğŸ“… Raw task data:", JSON.stringify(req.body, null, 2));

// ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­ÙˆÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®
const taskData = {
  ...req.body,
  dueDate: req.body.dueDate ? new Date(req.body.dueDate) : null,
  createdAt: new Date(), // ØªØ£ÙƒØ¯ Ù…Ù† Ù‡Ø°Ø§ Ø£ÙŠØ¶Ø§Ù‹
};
```

#### **3. Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø§Ù„Ø¬ Ø£Ø®Ø·Ø§Ø¡ Ù…Ø­Ø³Ù‘Ù†**
```typescript
try {
  const newTask = await db.insert(tasks).values(taskData).returning();
  res.status(201).json(newTask);
} catch (error) {
  console.error("âŒ Task creation error:", error.message);
  console.error("ğŸ“¦ Payload causing error:", JSON.stringify(taskData, null, 2));
  res.status(400).json({ 
    error: "ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©: ØªÙ†Ø³ÙŠÙ‚ ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­",
    details: error.message 
  });
}
```

---

### **âš¡ Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØµØ­ÙŠØ­ Ø§Ù„Ø³Ø±ÙŠØ¹**

1. **Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø± Ù‚Ø¨Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù…Ø©**:
   ```typescript
   console.log("ğŸ” dueDate type:", typeof req.body.dueDate, "value:", req.body.dueDate);
   ```

2. **ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Drizzle schema**:
   ```typescript
   // ÙÙŠ ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„
   dueDate: timestamp("due_date", { mode: "date" }), // ØªØ£ÙƒØ¯ Ù…Ù† mode
   ```

3. **ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø£Ù…Ø§Ù…ÙŠØ© (Frontend)**:
   ```javascript
   // ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ ISO string Ø£Ùˆ Date object
   const taskData = {
     dueDate: new Date(dueDateInput).toISOString(), // Ø£Ùˆ new Date()
   };
   ```

---

### **ğŸ¯ Ø§Ù„Ø³Ø¨Ø¨ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±**
Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… `admin-sabq` Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ§Øª ÙƒØ§Ù…Ù„Ø©ØŒ ÙˆØ§Ù„ØªØ­Ù‚Ù‚ ÙŠÙ…Ø± Ø¨Ù†Ø¬Ø§Ø­. Ù„ÙƒÙ† Ø¹Ù†Ø¯ Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‡Ù…Ø©ØŒ **Ø­Ù‚Ù„ Ø§Ù„ØªØ§Ø±ÙŠØ® ÙŠØ£ØªÙŠ ÙƒÙ†Øµ Ù†Ø§Ù‚Øµ Ø£Ùˆ Ø¨ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Ø·Ø¦**ØŒ Ù…Ù…Ø§ ÙŠØ¬Ø¹Ù„ Drizzle ÙŠÙØ´Ù„ ÙÙŠ ØªØ­ÙˆÙŠÙ„Ù‡ Ù„ØªÙˆØ§Ø±ÙŠØ® Postgres.

**Ø§Ù„Ø­Ù„ Ø§Ù„ÙÙˆØ±ÙŠ**: Ø£Ø¶Ù Ø§Ù„ØªØ­Ù‚Ù‚ ÙˆØ§Ù„ØªØ­ÙˆÙŠÙ„ ÙÙŠ Ø§Ù„Ù€ middleware Ø£Ùˆ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„Ù€ handler Ù‚Ø¨Ù„ Ø§Ù„Ù€ `.insert()`.